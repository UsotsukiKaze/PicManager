<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PicManager - 图片管理系统</title>
    <link rel="icon" href="/static/icon/Pic.ico" type="image/x-icon">
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/icons.css">
</head>
<body>
    <div class="app-container">
        <!-- 顶部用户信息栏 -->
        <div class="top-user-bar" id="top-user-bar">
            <div class="user-info-compact">
                <img class="user-avatar-small" id="header-avatar" src="" alt="" style="display: none;">
                <span class="user-name-small" id="header-username">--</span>
                <span class="user-role-small" id="header-role"></span>
            </div>
            <div class="user-actions-compact">
                <a href="/profile" class="header-link">
                    <span class="inline-icon icon-user"></span>
                    <span>个人中心</span>
                </a>
                <button class="header-link" id="logout-btn" onclick="handleLogout()">
                    <span class="inline-icon icon-logout"></span>
                    <span>退出</span>
                </button>
            </div>
        </div>

        <!-- 主内容区域包装 -->
        <div class="main-wrapper">
            <!-- 侧边导航栏 -->
            <nav class="sidebar">
                <div class="sidebar-header">
                    <div class="logo">
                        <span class="logo-icon"></span>
                        <img class="logo-image" src="/static/icon/Pic.ico" alt="PicManager">
                        <h1 class="logo-text">PicManager</h1>
                    </div>
                </div>
                
                <div class="sidebar-menu">
                    <a href="#" class="menu-item active" data-page="management">
                        <span class="menu-icon"></span>
                        <span class="menu-text">图片管理</span>
                    </a>
                    <a href="#" class="menu-item" data-page="upload">
                        <span class="menu-icon"></span>
                        <span class="menu-text">上传图片</span>
                    </a>
                    <a href="#" class="menu-item" data-page="settings">
                        <span class="menu-icon"></span>
                        <span class="menu-text">系统设置</span>
                    </a>
                </div>
                
                <div class="sidebar-footer">
                    <div class="system-status">
                        <div class="status-item">
                            <span class="status-label">图片总数</span>
                            <span class="status-value" id="total-images">0</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">分组数</span>
                            <span class="status-value" id="total-groups">0</span>
                        </div>
                    </div>
                </div>
            </nav>

            <!-- 主内容区域 -->
            <main class="main-content">
                <!-- 图片管理页面 -->
                <div class="page-content" id="page-management">
                    <div class="page-header">
                        <h2>图片管理</h2>
                        <div class="header-actions">
                            <button class="btn btn-secondary" onclick="refreshData()">
                            刷新
                        </button>
                        <button class="btn btn-danger" onclick="cleanupOrphaned()">
                            清理无效记录
                        </button>
                    </div>
                </div>

                <!-- 标签页 -->
                <div class="tab-container">
                    <div class="tab-header">
                        <button class="tab-btn active" data-tab="image-list">图片列表</button>
                        <button class="tab-btn" data-tab="group-management">分组管理</button>
                        <button class="tab-btn" data-tab="character-management">角色管理</button>
                    </div>

                    <!-- 图片列表标签页 -->
                    <div class="tab-content" id="tab-image-list">
                        <div class="search-section">
                            <div class="search-form">
                                <!-- 基础搜索 -->
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>分组筛选</label>
                                        <div class="searchable-select" id="search-group-container">
                                            <input type="text" class="form-input searchable-input" id="search-group-input" placeholder="搜索或选择分组..." autocomplete="off">
                                            <input type="hidden" id="search-group" value="">
                                            <div class="searchable-dropdown" id="search-group-dropdown"></div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>角色筛选</label>
                                        <div class="searchable-select" id="search-character-container">
                                            <input type="text" class="form-input searchable-input" id="search-character-input" placeholder="搜索或选择角色..." autocomplete="off">
                                            <input type="hidden" id="search-character" value="">
                                            <div class="searchable-dropdown" id="search-character-dropdown"></div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="search-pid">PID搜索</label>
                                        <input type="text" id="search-pid" class="form-input" placeholder="输入PID搜索">
                                    </div>
                                    <div class="form-group form-actions-group">
                                        <button class="btn btn-primary" onclick="searchImages()">
                                            搜索
                                        </button>
                                        <button class="btn btn-secondary" onclick="clearSearch()">
                                            清空
                                        </button>
                                        <button class="btn btn-outline advanced-toggle-btn" onclick="toggleAdvancedSearch()">
                                            <span class="toggle-icon" id="advanced-toggle-icon">▶</span>
                                            高级
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- 高级搜索面板 -->
                                <div class="advanced-search-panel" id="advanced-search-panel" style="display: none;">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="search-image-id">图片序号 (ID)</label>
                                            <input type="text" id="search-image-id" class="form-input" placeholder="输入10位图片序号">
                                        </div>
                                        <div class="form-group">
                                            <button class="btn btn-primary" onclick="searchByImageId()">
                                                序号搜索
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="image-grid" id="image-grid">
                            <!-- 图片网格将通过JavaScript动态生成 -->
                        </div>

                        <div class="pagination" id="pagination">
                            <!-- 分页控件将通过JavaScript动态生成 -->
                        </div>
                    </div>

                    <!-- 分组管理标签页 -->
                    <div class="tab-content" id="tab-group-management" style="display: none;">
                        <div class="search-bar" style="margin-bottom: 24px;">
                            <div class="form-row">
                                <div class="form-group">
                                    <button class="btn btn-primary" onclick="showCreateGroupModal()">
                                        新建分组
                                    </button>
                                </div>
                                <div class="form-group" style="flex: 1;">
                                    <input type="text" id="group-search-input" class="form-input" placeholder="搜索分组 (支持拼音首字母)">
                                </div>
                            </div>
                        </div>

                        <div class="group-list" id="group-list">
                            <!-- 分组列表将通过JavaScript动态生成 -->
                        </div>
                    </div>

                    <!-- 角色管理标签页 -->
                    <div class="tab-content" id="tab-character-management" style="display: none;">
                        <div class="search-bar" style="margin-bottom: 24px;">
                            <div class="form-row">
                                <div class="form-group">
                                    <button class="btn btn-primary" onclick="showCreateCharacterModal()">
                                        新建角色
                                    </button>
                                </div>
                                <div class="form-group" style="flex: 1;">
                                    <div class="searchable-select" id="character-group-filter-container">
                                        <input type="text" class="form-input searchable-input" id="character-group-filter-input" placeholder="搜索或选择分组..." autocomplete="off">
                                        <input type="hidden" id="character-group-filter" value="">
                                        <div class="searchable-dropdown" id="character-group-filter-dropdown"></div>
                                    </div>
                                </div>
                                <div class="form-group" style="flex: 2;">
                                    <input type="text" id="character-search-input" class="form-input" placeholder="搜索角色 (支持拼音首字母)">
                                </div>
                            </div>
                        </div>

                        <div class="character-list" id="character-list">
                            <!-- 角色列表将通过JavaScript动态生成 -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- 上传图片页面 -->
            <div class="page-content" id="page-upload" style="display: none;">
                <div class="page-header">
                    <h2>上传图片</h2>
                </div>

                <!-- 上传标签页 -->
                <div class="tab-container">
                    <div class="tab-header">
                        <button class="tab-btn active" data-tab="single-upload">单张上传</button>
                        <button class="tab-btn" data-tab="batch-upload">批量上传</button>
                        <button class="tab-btn" data-tab="temp-upload">
                            Temp目录上传
                            <span class="temp-count-badge" id="temp-count-badge" style="display: none;"></span>
                        </button>
                    </div>

                    <!-- 单张上传 -->
                    <div class="tab-content" id="tab-single-upload">
                        <div class="upload-section">
                            <div class="upload-area" id="single-upload-area">
                                <div class="upload-placeholder">
                                    <p>拖拽图片到此处或点击选择</p>
                                    <input type="file" id="single-file-input" accept="image/*" style="display: none;">
                                </div>
                                <div class="upload-preview" id="single-preview" style="display: none;">
                                    <img id="single-preview-img" alt="预览图">
                                    <div class="preview-info">
                                        <p id="single-filename"></p>
                                    </div>
                                </div>
                            </div>

                            <div class="upload-form" id="single-upload-form" style="display: none;">
                                <div class="single-filename-info" id="single-filename-info"></div>
                                <div class="form-group">
                                    <label for="single-group-select">选择分组</label>
                                    <select id="single-group-select" class="form-select" required>
                                        <option value="">请选择分组</option>
                                    </select>
                                    <button type="button" class="btn-link" onclick="showCreateGroupModal(true)">新建分组</button>
                                </div>

                                <div class="form-group">
                                    <label>选择角色</label>
                                    <div id="single-character-selector"></div>
                                    <button type="button" class="btn-link" onclick="showCreateCharacterModal(true)">新建角色</button>
                                </div>

                                <div class="form-group">
                                    <label for="single-pid">PID (可选)</label>
                                    <input type="text" id="single-pid" class="form-input" placeholder="输入PID">
                                </div>

                                <div class="form-group">
                                    <label for="single-description">描述 (可选)</label>
                                    <textarea id="single-description" class="form-textarea" placeholder="输入图片描述"></textarea>
                                </div>

                                <div class="form-actions">
                                    <button type="button" class="btn btn-secondary" onclick="clearSingleUpload()">清空</button>
                                    <button type="button" class="btn btn-primary" onclick="uploadSingleImage()">上传图片</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 批量上传 -->
                    <div class="tab-content" id="tab-batch-upload" style="display: none;">
                        <div class="upload-section">
                            <div class="upload-area" id="batch-upload-area">
                                <div class="upload-placeholder">
                                    <p>选择多张图片进行批量上传</p>
                                    <input type="file" id="batch-file-input" accept="image/*" multiple style="display: none;">
                                </div>
                            </div>

                            <div class="batch-upload-list" id="batch-upload-list">
                                <!-- 批量上传列表将通过JavaScript动态生成 -->
                            </div>
                        </div>
                    </div>

                    <!-- Temp目录上传 -->
                    <div class="tab-content" id="tab-temp-upload" style="display: none;">
                        <div class="temp-upload-section">
                            <div class="temp-info">
                                <p>检测到 <span id="temp-image-count">0</span> 张图片在temp目录中</p>
                                <button class="btn btn-secondary btn-sm" onclick="refreshTempImages()">刷新</button>
                            </div>

                            <div class="temp-image-grid" id="temp-image-grid">
                                <!-- Temp图片网格将通过JavaScript动态生成 -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 系统设置页面 -->
            <div class="page-content" id="page-settings" style="display: none;">
                <div class="page-header">
                    <h2>系统设置</h2>
                </div>

                <div class="settings-section">
                    <div class="settings-group">
                        <h3>系统信息</h3>
                        <div class="settings-item">
                            <label>存储路径</label>
                            <span id="store-path">/resource/store</span>
                        </div>
                        <div class="settings-item">
                            <label>临时路径</label>
                            <span id="temp-path">/resource/temp</span>
                        </div>
                    </div>

                    <div class="settings-group">
                        <h3>数据统计</h3>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" id="stat-images">0</div>
                                <div class="stat-label">图片总数</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="stat-groups">0</div>
                                <div class="stat-label">分组数量</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="stat-characters">0</div>
                                <div class="stat-label">角色数量</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="stat-temp">0</div>
                                <div class="stat-label">待处理图片</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        </div> <!-- 关闭 main-wrapper -->
    </div>

    <!-- 模态框 -->
    <div class="modal-overlay" id="modal-overlay" style="display: none;">
        <div class="modal" id="modal">
            <div class="modal-header">
                <h3 id="modal-title">标题</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- 模态框内容将通过JavaScript动态生成 -->
            </div>
        </div>
    </div>

    <!-- Toast 通知 -->
    <div class="toast-container" id="toast-container"></div>

    <!-- JavaScript -->
    <script src="/static/js/pinyin-search.js"></script>
    <script src="/static/js/character-selector.js"></script>
    <script src="/static/js/api.js"></script>
    <script src="/static/js/ui.js"></script>
    <script src="/static/js/upload.js"></script>
    <script src="/static/js/main.js"></script>
    <script src="/static/js/auth.js"></script>
</body>
</html>